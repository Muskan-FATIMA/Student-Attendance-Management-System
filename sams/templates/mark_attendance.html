{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mark Attendance</title>
    <link rel="icon" href="{% static "images/favicon.png" %}" type="image/png">
    <link
    href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
  />
  <link rel="stylesheet" href="{% static "css/style.css" %}" />
  <link rel="stylesheet" href="{% static "css/responsive.css" %}" />
</head>
  <body>
    <div class="hamburger" id="hamburger">
    <i class="fa-solid fa-bars"></i>
  </div>
    <div class="a-page">
        <aside class="a-sidebar" id="sidebar">   
        <div class="close-btn" id="closeBtn">
         <i class="fa-solid fa-xmark"></i>
       </div>
        <img
        src="{% static "images/su-logo-white.png" %}"
        alt="SU-logo-white"
        class="su-logo-white"
      />
      <div class="line-below-logo"></div>
      <div class="a-sidebar-links">
        <a 
        href="{% url "teacher_profile" %}" 
        class="teacher-profile">
          <i class="fa-solid fa-user"></i>
          <span>Manage Your Profile</span>
        </a>
        <a
          href="{% url "mark_attendance" %}"
          class="mark-attendance"
        >
          <i class="fa-regular fa-square-check" style="color: #fdb813"></i>
          <span style="color: #fdb813">Mark Attendance</span>
        </a>
        <a
          href="{% url "attendance_record" %}"
          class="attendance-record"
        >
          <i class="fa-regular fa-clipboard"></i>
          <span>Attendance Record</span>
        </a>
   <a
        href="{% url "attendance_analytics" %}"
        class="analytics"
      >
      <i class="fa-solid fa-chart-line"></i>
        <span>Attendance Analytics</span>
      </a>

        <div class="line-above-logout"></div>
        <a 
        href="{% url "logout" %}" 
        class="logout">
          <i class="fa-solid fa-arrow-right-from-bracket"></i>
          <span>Logout</span>
        </a>
        </div>
      </aside>
      <div class="a-main">
        <div class="a-heading">
          <h1>MARK TODAY'S ATTENDANCE - {{ selected_course.course_name }} ({{ selected_batch.batch_year }}) Sem {{ selected_semester.semester_num }} ({{ selected_section.section_name }}) "{{ selected_subject.subject_name }}"</h1>
        </div>
        {% if messages %}
        <div class="messages">
          {% for message in messages %}
            <div class="message {% if message.tags %}{{ message.tags }}{% endif %}">
              <button class="close-btn" onclick="this.parentElement.style.display='none';"><i class="fa-solid fa-xmark"></i></button>
              <p>{{ message }}</p>
            </div>
          {% endfor %}
        </div>
      {% endif %}
        <div class="m-a-main-container">
          <div class="m-a-list-container">
              <form id="filterForm" method="POST" action="">
                  {% csrf_token %}
 <button class="filter-toggle" id="filterToggleBtn">
                  <i class="fa-solid fa-filter"></i> Show Filters
                   </button>
        <div id="filterOptions" class="dropdown-section hide">
                      <div class="batch">
                          <label for="choose_batch">Choose Batch</label>
                          <select name="batch" id="choose_batch" onchange="this.form.submit()">
                            <option value="" disabled selected>Batch</option>
                              {% for batch in batches %}
                                  <option value="{{ batch.id }}" {% if selected_batch and batch.id == selected_batch.id %}selected{% endif %}>
                                      {{ batch.batch_year }}
                                  </option>
                              {% endfor %}
                          </select>
                      </div>
                      <div class="course">
                          <label for="choose_course">Choose Course</label>
                          <select name="course" id="choose_course" onchange="this.form.submit()">
                            <option value="" disabled selected>Course</option>
                              {% for course in courses %}
                                  <option value="{{ course.id }}" {% if selected_course and course.id == selected_course.id %}selected{% endif %}>
                                      {{ course.course_name }}
                                  </option>
                              {% endfor %}
                          </select>
                      </div>
                      <div class="semester">
                          <label for="choose_semester">Choose Semester</label>
                          <select name="semester" id="choose_semester" onchange="this.form.submit()">
                            <option value="" disabled selected>Semester</option>
                              {% for semester in semesters %}
                                  <option value="{{ semester.id }}" {% if selected_semester and semester.id == selected_semester.id %}selected{% endif %}>
                                      {{ semester.semester_num }}
                                  </option>
                              {% endfor %}
                          </select>
                      </div>
                      <div class="subject">
                          <label for="choose_subject">Choose Subject</label>
                          <select name="subject" id="choose_subject">
                             <option value="" disabled selected>Subject</option>
                              {% for subject in subjects %}
                                  <option value="{{ subject.id }}" {% if selected_subject and subject.id == selected_subject.id %}selected{% endif %}>
                                      {{ subject.subject_name }}
                                  </option>
                              {% endfor %}
                          </select>
                      </div>
                      <div class="section">
                          <label for="choose_section">Choose Section</label>
                          <select name="section" id="choose_section" onchange="this.form.submit()">
                             <option value="" disabled selected>Section</option>
                              {% for section in sections %}
                                  <option value="{{ section.id }}" {% if selected_section and section.id == selected_section.id %}selected{% endif %}>
                                      {{ section.section_name }}
                                  </option>
                              {% endfor %}
                          </select>
                      </div>
                  </div>
                  <div class="mark-att-container">
                  <table border="3" class="m-a-table">
                      <tr>
                          <th>Student Name</th>
                          <th>Student Roll No.</th>
                          <th>Present/Absent</th>
                      </tr>
                      {% for student in students %}
                          <tr>
                              <td>{{ student.student_name }}</td>
                              <td>{{ student.student_roll }}</td>
                              <td>
                                  <input type="checkbox" name="attendance_{{ student.student_id }}" value="true" {% if student.student_id in selected_attendance %}checked{% endif %}>
                              </td>
                          </tr>
                      {% empty %}
                          <tr>
                              <td colspan="3">No students found.</td>
                          </tr>
                      {% endfor %}
                  </table>
      
                  <button type="submit" name="submit_attendance" class="submit-btn">
                      SUBMIT
                  </button>
                </div>
              </form>
          </div>
      </div>      
    </div>
    <script src="{% static "js/index.js" %}" ></script>
  </body>
</html>
